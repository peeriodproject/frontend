/**
 * @jsx React.DOM
 */
'use strict';

var DropzoneBackroundRenderer = require('../utils/DropzoneBackroundRenderer');

var DownloadDestinationDropzoneMixin = {

	componentWillMount: function () {
		try {
			this._dropzoneBackground = window.localStorage.getItem('downloadDestinationDropzoneBackground');
			this._dropzoneButton = JSON.parse(window.localStorage.getItem('downloadDestinationDropzoneButton'));
		}
		catch (e) {
			console.log(e);

			this._dropzoneBackground = null;
			this._dropzoneButton = null;
		}
	},

	updateFolderdropzoneChannelState: function (state) {
		var paths = state.downloadDestination || [];

		if (paths.length) {
			this.shareChannel.send('updateDownloadDestination', paths[0]);
		}
	},

	openDropzoneWindow: function () {
		this.folderdropzoneChannel.send('open', 'downloadDestination', this._dropzoneBackground, this._dropzoneButton);
	},

	dropzoneRendered: function (data) {
		this._dropzoneBackground = data.background;
		this._dropzoneButton = data.button;
		console.log(this._dropzoneButton);

		try {
			window.localStorage.setItem('downloadDestinationDropzoneBackground', this._dropzoneBackground);
			window.localStorage.setItem('downloadDestinationDropzoneButton', JSON.stringify(this._dropzoneButton));
		}
		catch (e) {
			console.log(e);
		}
	},

	getDropzone: function () {
		if (this._dropzoneBackground && this._dropzoneButton) {
			return null;
		}

		return  (
			<DropzoneBackroundRenderer
				title={this.i18n('dropzone_selectDownloadDestination_title')}
				description={this.i18n('dropzone_selectDownloadDestination_description')}
				image='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjgwcHgiIGhlaWdodD0iNjBweCIgdmlld0JveD0iMCAwIDgwIDYwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPGcgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGc+CiAgICAgICAgICAgIDxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDguMDAwMDAwLCA1LjAwMDAwMCkiPgogICAgICAgICAgICAgICAgPHBhdGggZD0iTTAsNDcgQzAsNDguNjU3IDEuMzQzLDUwIDMsNTAgTDYxLDUwIEM2Mi42NTcsNTAgNjQsNDguNjU3IDY0LDQ3IEw2NCwxNSBMMCwxNSBMMCw0NyBMMCw0NyBaIE02MSw2IEwyMy45ODIsNiBMMTgsMCBMMywwIEMxLjM0MywwIDAsMS4zNDMgMCwzIEwwLDEyIEw2NCwxMiBMNjQsOSBDNjQsNy4zNDMgNjIuNjU3LDYgNjEsNiBaIE00MS43MzA3NjkyLDMzIEM0MS4wMjk3MzA4LDMzIDQwLjQ2MTUzODUsMzMuNTc1NTcxNCA0MC40NjE1Mzg1LDM0LjI4NTcxNDMgTDQwLjQ2MTUzODUsMzkuNDI4NTcxNCBMMjMuNTM4NDYxNSwzOS40Mjg1NzE0IEwyMy41Mzg0NjE1LDM0LjI4NTcxNDMgQzIzLjUzODQ2MTUsMzMuNTc1NTcxNCAyMi45NzAyNjkyLDMzIDIyLjI2OTIzMDgsMzMgQzIxLjU2ODE5MjMsMzMgMjEsMzMuNTc1NTcxNCAyMSwzNC4yODU3MTQzIEwyMSw0MC43MTQyODU3IEMyMSw0MS40MjQ0Mjg2IDIxLjU2ODE5MjMsNDIgMjIuMjY5MjMwOCw0MiBMMzEuOTk4NzMwOCw0MiBMMzIsNDIgTDMyLjAwMTI2OTIsNDIgTDQxLjczMDc2OTIsNDIgQzQyLjQzMTgwNzcsNDIgNDMsNDEuNDI0NDI4NiA0Myw0MC43MTQyODU3IEw0MywzNC4yODU3MTQzIEM0MywzMy41NzU1NzE0IDQyLjQzMTgwNzcsMzMgNDEuNzMwNzY5MiwzMyBaIE0yNy4zMjA4MzMzLDMwLjUzNDA5MzggTDMxLjA3MDgzMzMsMzQuNTk2NTkzOCBDMzEuMjk5NTgzMywzNC44NDQgMzEuNjMxMjUsMzUgMzIsMzUgQzMyLjM2ODc1LDM1IDMyLjcsMzQuODQ0IDMyLjkyOTE2NjcsMzQuNTk2NTkzNyBMMzYuNjc5MTY2NywzMC41MzQwOTM3IEMzNi44NzgzMzMzLDMwLjMxNzk2ODcgMzcsMzAuMDMyMzc1IDM3LDI5LjcxODc1IEMzNywyOS4wNDU1OTM4IDM2LjQ0MDQxNjcsMjguNSAzNS43NSwyOC41IEMzNS4zODEyNSwyOC41IDM1LjA0OTE2NjcsMjguNjU1NTkzOCAzNC44MjA4MzMzLDI4LjkwMzQwNjIgTDMzLjI1LDMwLjYwNTE4NzUgTDMzLjI1LDIzLjIxODc1IEMzMy4yNSwyMi41NDU1OTM3IDMyLjY5MDQxNjcsMjIgMzIsMjIgQzMxLjMwOTU4MzMsMjIgMzAuNzUsMjIuNTQ1NTkzNyAzMC43NSwyMy4yMTg3NSBMMzAuNzUsMzAuNjA1MTg3NSBMMjkuMTc5MTY2NywyOC45MDM0MDYyIEMyOC45NTA0MTY3LDI4LjY1NiAyOC42MTg3NSwyOC41IDI4LjI1LDI4LjUgQzI3LjU1OTU4MzMsMjguNSAyNywyOS4wNDU1OTM4IDI3LDI5LjcxODc1IEMyNywzMC4wMzIzNzUgMjcuMTIxNjY2NywzMC4zMTc5Njg3IDI3LjMyMDgzMzMsMzAuNTM0MDkzOCBaIiBmaWxsLW9wYWNpdHk9IjAuNzUiIGZpbGw9IiM1OTU5NTkiPjwvcGF0aD4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik02NS4zMDQzNDc4LDQxLjY5NTY1MjIgTDY1LjMwNDM0NzgsMzcuMzA0MzQ3OCBDNjUuMzA0MzQ3OCwzNi41ODM5MTMgNjQuNzIwNDM0OCwzNiA2NCwzNiBDNjMuMjc5NTY1MiwzNiA2Mi42OTU2NTIyLDM2LjU4MzkxMyA2Mi42OTU2NTIyLDM3LjMwNDM0NzggTDYyLjY5NTY1MjIsNDEuNjk1NjUyMiBMNTguMzA0MzQ3OCw0MS42OTU2NTIyIEM1Ny41ODM5MTMsNDEuNjk1NjUyMiA1Nyw0Mi4yNzk1NjUyIDU3LDQzIEM1Nyw0My43MjA0MzQ4IDU3LjU4MzkxMyw0NC4zMDQzNDc4IDU4LjMwNDM0NzgsNDQuMzA0MzQ3OCBMNjIuNjk1NjUyMiw0NC4zMDQzNDc4IEw2Mi42OTU2NTIyLDQ4LjY5NTY1MjIgQzYyLjY5NTY1MjIsNDkuNDE2MDg3IDYzLjI3OTU2NTIsNTAgNjQsNTAgQzY0LjcyMDQzNDgsNTAgNjUuMzA0MzQ3OCw0OS40MTYwODcgNjUuMzA0MzQ3OCw0OC42OTU2NTIyIEw2NS4zMDQzNDc4LDQ0LjMwNDM0NzggTDY5LjY5NTY1MjIsNDQuMzA0MzQ3OCBDNzAuNDE2MDg3LDQ0LjMwNDM0NzggNzEsNDMuNzIwNDM0OCA3MSw0MyBDNzEsNDIuMjc5NTY1MiA3MC40MTYwODcsNDEuNjk1NjUyMiA2OS42OTU2NTIyLDQxLjY5NTY1MjIgTDY1LjMwNDM0NzgsNDEuNjk1NjUyMiBaIiBmaWxsPSIjMDBEOTdFIj48L3BhdGg+CiAgICAgICAgICAgIDwvZz4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPg=='
				onRendered={this.dropzoneRendered} />
		)
	}

};

module.exports = DownloadDestinationDropzoneMixin;